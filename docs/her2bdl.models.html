

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>her2bdl.models package &mdash; Her2BDL 0.0.0-alpha documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> Her2BDL
          

          
          </a>

          
            
            
              <div class="version">
                0.0.0-alp
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <!-- Local TOC -->
              <div class="local-toc"><ul>
<li><a class="reference internal" href="#">her2bdl.models package</a><ul>
<li><a class="reference internal" href="#submodules">Submodules</a></li>
<li><a class="reference internal" href="#module-her2bdl.models.aggregation">her2bdl.models.aggregation module</a></li>
<li><a class="reference internal" href="#module-her2bdl.models.layers">her2bdl.models.layers module</a><ul>
<li><a class="reference internal" href="#custom-layers">Custom Layers</a></li>
</ul>
</li>
<li><a class="reference internal" href="#module-her2bdl.models.loss">her2bdl.models.loss module</a><ul>
<li><a class="reference internal" href="#loss-functions">Loss Functions</a></li>
</ul>
</li>
<li><a class="reference internal" href="#module-her2bdl.models.mcdropout">her2bdl.models.mcdropout module</a><ul>
<li><a class="reference internal" href="#uncertainty-models">Uncertainty Models</a></li>
</ul>
</li>
<li><a class="reference internal" href="#module-her2bdl.models.metrics">her2bdl.models.metrics module</a><ul>
<li><a class="reference internal" href="#classification-metrics">Classification Metrics</a></li>
</ul>
</li>
<li><a class="reference internal" href="#module-her2bdl.models.uncertainty">her2bdl.models.uncertainty module</a><ul>
<li><a class="reference internal" href="#uncertainty-meassures">Uncertainty Meassures</a></li>
</ul>
</li>
<li><a class="reference internal" href="#module-her2bdl.models">Module contents</a><ul>
<li><a class="reference internal" href="#models">Models</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Her2BDL</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>her2bdl.models package</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/her2bdl.models.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="her2bdl-models-package">
<h1>her2bdl.models package<a class="headerlink" href="#her2bdl-models-package" title="Permalink to this headline">¶</a></h1>
<div class="section" id="submodules">
<h2>Submodules<a class="headerlink" href="#submodules" title="Permalink to this headline">¶</a></h2>
</div>
<div class="section" id="module-her2bdl.models.aggregation">
<span id="her2bdl-models-aggregation-module"></span><h2>her2bdl.models.aggregation module<a class="headerlink" href="#module-her2bdl.models.aggregation" title="Permalink to this headline">¶</a></h2>
<dl class="py class">
<dt class="sig sig-object py" id="her2bdl.models.aggregation.Aggregator">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">her2bdl.models.aggregation.</span></span><span class="sig-name descname"><span class="pre">Aggregator</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">uncertainty_metric</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">by</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'CaseNo_label'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#her2bdl.models.aggregation.Aggregator" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">abc.ABC</span></code></p>
<dl class="py method">
<dt class="sig sig-object py" id="her2bdl.models.aggregation.Aggregator.predict_with_aggregation">
<span class="sig-name descname"><span class="pre">predict_with_aggregation</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dataset</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">predictions_results</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">uncertainty_results</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">include_data</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#her2bdl.models.aggregation.Aggregator.predict_with_aggregation" title="Permalink to this definition">¶</a></dt>
<dd><p>Aggregate predictions with epistemic uncertainty results for dataset.
:param dataset: Data generator or TF_Dataset.
:type dataset: <cite>keras.utils.Sequence</cite> or <cite>ParallelMapDataset</cite>
:param predictions_results: Predictions for the dataset.
:type predictions_results: <cite>dict</cite>
:param uncertainty_results: Epistemic uncertainty for the dataset.
:type uncertainty_results: <cite>dict</cite>
:param include_data: Returns images and y_true from dataset.
:type include_data: <cite>bool`</cite>
:param kwargs: keras.Model.predict kwargs.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>Aggregated prediction and uncertainty results for dataset.</p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>(<cite>dict</cite>, <cite>dict</cite>)</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="her2bdl.models.aggregation.MixtureAggregator">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">her2bdl.models.aggregation.</span></span><span class="sig-name descname"><span class="pre">MixtureAggregator</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">uncertainty_metric</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">by</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'CaseNo_label'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#her2bdl.models.aggregation.MixtureAggregator" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#her2bdl.models.aggregation.Aggregator" title="her2bdl.models.aggregation.Aggregator"><code class="xref py py-class docutils literal notranslate"><span class="pre">her2bdl.models.aggregation.Aggregator</span></code></a></p>
<dl class="py method">
<dt class="sig sig-object py" id="her2bdl.models.aggregation.MixtureAggregator.get_weights">
<span class="sig-name descname"><span class="pre">get_weights</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">uncertainty</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#her2bdl.models.aggregation.MixtureAggregator.get_weights" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="her2bdl.models.aggregation.ThresholdAggregator">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">her2bdl.models.aggregation.</span></span><span class="sig-name descname"><span class="pre">ThresholdAggregator</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">uncertainty_metric</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">threshold</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">by</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'CaseNo_label'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#her2bdl.models.aggregation.ThresholdAggregator" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#her2bdl.models.aggregation.Aggregator" title="her2bdl.models.aggregation.Aggregator"><code class="xref py py-class docutils literal notranslate"><span class="pre">her2bdl.models.aggregation.Aggregator</span></code></a></p>
</dd></dl>

</div>
<div class="section" id="module-her2bdl.models.layers">
<span id="her2bdl-models-layers-module"></span><h2>her2bdl.models.layers module<a class="headerlink" href="#module-her2bdl.models.layers" title="Permalink to this headline">¶</a></h2>
<div class="section" id="custom-layers">
<h3>Custom Layers<a class="headerlink" href="#custom-layers" title="Permalink to this headline">¶</a></h3>
<p>Collection of models custom layers.</p>
<dl class="py class">
<dt class="sig sig-object py" id="her2bdl.models.layers.Separate_HED_stains">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">her2bdl.models.layers.</span></span><span class="sig-name descname"><span class="pre">Separate_HED_stains</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#her2bdl.models.layers.Separate_HED_stains" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">tensorflow.python.keras.engine.base_layer.Layer</span></code></p>
<p>Color descomposition of Her2 images in Haematoxylin-Eosin-DAB colorspace</p>
<p>This layer takes input images of any shape, and the input data
should range [0, 255]. Output is normalized to range [0, 1].</p>
<p>This is a Keras implementation of the scikit-image <cite>separate_stains</cite> method.</p>
<p>Haematoxylin-Eosin-DAB colorspace
From original Ruifrok’s paper: A. C. Ruifrok and D. A. Johnston,
“Quantification of histochemical staining by color deconvolution.,”
Analytical and quantitative cytology and histology / the International
Academy of Cytology [and] American Society of Cytology, vol. 23, no. 4,
pp. 291-9, Aug. 2001.</p>
<dl class="py method">
<dt class="sig sig-object py" id="her2bdl.models.layers.Separate_HED_stains.call">
<span class="sig-name descname"><span class="pre">call</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">inputs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#her2bdl.models.layers.Separate_HED_stains.call" title="Permalink to this definition">¶</a></dt>
<dd><p>This is where the layer’s logic lives.</p>
<p>Note here that <cite>call()</cite> method in <cite>tf.keras</cite> is little bit different
from <cite>keras</cite> API. In <cite>keras</cite> API, you can pass support masking for
layers as additional arguments. Whereas <cite>tf.keras</cite> has <cite>compute_mask()</cite>
method to support masking.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>inputs</strong> – Input tensor, or list/tuple of input tensors.</p></li>
<li><p><strong>**kwargs</strong> – Additional keyword arguments. Currently unused.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A tensor or list/tuple of tensors.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="her2bdl.models.layers.Separate_HED_stains.get_config">
<span class="sig-name descname"><span class="pre">get_config</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#her2bdl.models.layers.Separate_HED_stains.get_config" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the config of the layer.</p>
<p>A layer config is a Python dictionary (serializable)
containing the configuration of a layer.
The same layer can be reinstantiated later
(without its trained weights) from this configuration.</p>
<p>The config of a layer does not include connectivity
information, nor the layer class name. These are handled
by <cite>Network</cite> (one layer of abstraction above).</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>Python dictionary.</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</div>
</div>
<div class="section" id="module-her2bdl.models.loss">
<span id="her2bdl-models-loss-module"></span><h2>her2bdl.models.loss module<a class="headerlink" href="#module-her2bdl.models.loss" title="Permalink to this headline">¶</a></h2>
<div class="section" id="loss-functions">
<h3>Loss Functions<a class="headerlink" href="#loss-functions" title="Permalink to this headline">¶</a></h3>
<p>Collections of different Loss function for probability distributions
and distance matrix.</p>
</div>
</div>
<div class="section" id="module-her2bdl.models.mcdropout">
<span id="her2bdl-models-mcdropout-module"></span><h2>her2bdl.models.mcdropout module<a class="headerlink" href="#module-her2bdl.models.mcdropout" title="Permalink to this headline">¶</a></h2>
<div class="section" id="uncertainty-models">
<h3>Uncertainty Models<a class="headerlink" href="#uncertainty-models" title="Permalink to this headline">¶</a></h3>
<p>Models for Image Classification with  predictive distributions and uncertainty measure.</p>
<p>[1] GAL, Yarin. Uncertainty in deep learning. University of Cambridge, 2016, vol. 1, no 3.</p>
<dl class="simple">
<dt>[2] KENDALL, Alex; GAL, Yarin. What uncertainties do we need in bayesian deep learning</dt><dd><p>for computer vision?. arXiv preprint arXiv:1703.04977, 2017.</p>
</dd>
</dl>
<dl class="py class">
<dt class="sig sig-object py" id="her2bdl.models.mcdropout.AleatoricModel">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">her2bdl.models.mcdropout.</span></span><span class="sig-name descname"><span class="pre">AleatoricModel</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#her2bdl.models.mcdropout.AleatoricModel" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">tensorflow.python.keras.engine.training.Model</span></code></p>
<p>Aleatoric Data Modeling.</p>
<p>AleatoricModel has basics methods from <cite>tf.keras.Model</cite> for training, the
model architecture is defined from a predefined MCDropoutModel.</p>
<p>This model is used to evaluate the aleatoric uncertainty from data as explained
in by the author in [2]. As this model requires a MCDropoutModel, it can use
the trained weights of the Encoder submodel, but as the MC dropout layers
are not required and it needs to learn the variance, Classifier’s weights
are ignored.</p>
<p>Implemntation inspired by:
<a class="reference external" href="https://towardsdatascience.com/building-a-bayesian-deep-learning-classifier-ece1845bc09">https://towardsdatascience.com/building-a-bayesian-deep-learning-classifier-ece1845bc09</a>
<a class="reference external" href="https://github.com/ShellingFord221/My-implementation-of-What-Uncertainties-Do-We-Need-in-Bayesian-Deep-Learning-for-Computer-Vision/blob/master/classification_aleatoric.py">https://github.com/ShellingFord221/My-implementation-of-What-Uncertainties-Do-We-Need-in-Bayesian-Deep-Learning-for-Computer-Vision/blob/master/classification_aleatoric.py</a></p>
<dl class="py method">
<dt class="sig sig-object py" id="her2bdl.models.mcdropout.AleatoricModel.build_aleatoric_loss">
<span class="sig-name descname"><span class="pre">build_aleatoric_loss</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">T</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#her2bdl.models.mcdropout.AleatoricModel.build_aleatoric_loss" title="Permalink to this definition">¶</a></dt>
<dd><p>Build the Negative Log Likehood loss with Monte-Carlo Sampling from [2].</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>T</strong> (<cite>int</cite> or <cite>None</cite>) – Number of Monte-Carlo samples, if is <cite>None</cite>, it use models <cite>sample_size</cite>.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p><cite>function</cite> with arguments (y_true, y_pred)</p></li>
<li><p><em>Negative Log Likehood loss</em></p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="her2bdl.models.mcdropout.AleatoricModel.build_from_mcmodel">
<span class="sig-name descname"><span class="pre">build_from_mcmodel</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">mc_model</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#her2bdl.models.mcdropout.AleatoricModel.build_from_mcmodel" title="Permalink to this definition">¶</a></dt>
<dd><p>Build a new aleatoric model using the architecture defined for <cite>mc_model</cite>.
The encoder submodel is cloned and reused the same weights. The new
aleatoric classifier reuse the same architecture from the <cite>mc_model</cite> classifier
but removing the mc dropout layers, in consecuence, new weights are
initialized.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>mc_model</strong> (<cite>her2bdl.models.MCDropoutModel</cite>) – Base model to copy its architecture.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="her2bdl.models.mcdropout.AleatoricModel.call">
<span class="sig-name descname"><span class="pre">call</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">inputs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#her2bdl.models.mcdropout.AleatoricModel.call" title="Permalink to this definition">¶</a></dt>
<dd><p>Calls the model on new inputs.</p>
<p>In this case <cite>call</cite> just reapplies
all ops in the graph to the new inputs
(e.g. build a new computational graph from the provided inputs).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>inputs</strong> – A tensor or list of tensors.</p></li>
<li><p><strong>training</strong> – Boolean or boolean scalar tensor, indicating whether to run
the <cite>Network</cite> in training mode or inference mode.</p></li>
<li><p><strong>mask</strong> – A mask or list of masks. A mask can be
either a tensor or None (no mask).</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A tensor if there is a single output, or
a list of tensors if there are more than one outputs.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="her2bdl.models.mcdropout.AleatoricModel.predict_variance">
<span class="sig-name descname"><span class="pre">predict_variance</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">return_y_pred</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">return_variance</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#her2bdl.models.mcdropout.AleatoricModel.predict_variance" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculate predictive distrution and variance.
See [2]
This method returns the following <cite>np.ndarray</cite>:
- <cite>y_predictive_distribution</cite> is a normalized histogram with shape:</p>
<blockquote>
<div><p>(batch_size, classes)</p>
</div></blockquote>
<ul class="simple">
<li><p><cite>y_pred</cite> is the class predicted with shape: (batch_size,)</p></li>
<li><p><cite>y_predictions_variance</cite> is the predictive variation,
with shape: (batch_size,)</p></li>
</ul>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>x</strong> (<cite>np.ndarray</cite>  (batch_size, <a href="#id1"><span class="problematic" id="id2">*</span></a>input_shape)) – Batch of inputs, if is one input, automatically it’s converted to
a batch.</p></li>
<li><p><strong>return_y_pred</strong> (<cite>bool</cite>) – Return argmax y_predictive_distribution. If is <cite>False</cite>
<cite>y_pred</cite> is <cite>None</cite>.</p></li>
<li><p><strong>return_variance</strong> (<cite>bool</cite>) – Return predictive variation.
If is <cite>False</cite> <cite>y_predictions_variance</cite> is <cite>None</cite>.</p></li>
<li><p><strong>kwargs</strong> – keras.Model.predict kwargs.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Return 3 arrays with the model’s predictive distributions.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><cite>tuple</cite> of <cite>np.ndarray</cite> with length batch_size.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="her2bdl.models.mcdropout.AleatoricModel.predict_with_aleatoric_uncertainty">
<span class="sig-name descname"><span class="pre">predict_with_aleatoric_uncertainty</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dataset</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">include_data</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#her2bdl.models.mcdropout.AleatoricModel.predict_with_aleatoric_uncertainty" title="Permalink to this definition">¶</a></dt>
<dd><p>Prediction and aleatoric uncertainty results for x dataset.
:param dataset: Data generator.
:type dataset: <cite>np.ndarray</cite>  (batch_size, <a href="#id3"><span class="problematic" id="id4">*</span></a>input_shape)
:param include_data: Returns x and y_true from dataset.
:type include_data: <cite>bool`</cite>
:param kwargs: keras.Model.predict kwargs.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>Prediction and uncertainty results for x dataset.</p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>(<cite>dict</cite>, <cite>dict</cite>)</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="her2bdl.models.mcdropout.AleatoricModel.uncertainty">
<span class="sig-name descname"><span class="pre">uncertainty</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_predictive_variance</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">get_std</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">return_dict</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#her2bdl.models.mcdropout.AleatoricModel.uncertainty" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="her2bdl.models.mcdropout.EfficientNetMCDropout">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">her2bdl.models.mcdropout.</span></span><span class="sig-name descname"><span class="pre">EfficientNetMCDropout</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#her2bdl.models.mcdropout.EfficientNetMCDropout" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#her2bdl.models.mcdropout.MCDropoutModel" title="her2bdl.models.mcdropout.MCDropoutModel"><code class="xref py py-class docutils literal notranslate"><span class="pre">her2bdl.models.mcdropout.MCDropoutModel</span></code></a></p>
<p>EfficientNet MonteCarlo Dropout.
Keras EfficientNets models wrappers with extra dropout layers.</p>
<p>For B0 to B7 base models, the input shapes are different. Here is a list
of input shape expected for each model:</p>
<p>EfficientNetB0      224
EfficientNetB1      240
EfficientNetB2      260
EfficientNetB3      300
EfficientNetB4      380
EfficientNetB5      456
EfficientNetB6      528
EfficientNetB7      600</p>
<p>This model takes input images of shape (224, 224, 3), and the input data
should range [0, 255]. Normalization is included as part of the model.</p>
<dl class="py method">
<dt class="sig sig-object py" id="her2bdl.models.mcdropout.EfficientNetMCDropout.build_classifier_model">
<em class="property"><span class="pre">static</span> </em><span class="sig-name descname"><span class="pre">build_classifier_model</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">latent_variables_shape</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_classes</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mc_dropout_rate</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.2</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#her2bdl.models.mcdropout.EfficientNetMCDropout.build_classifier_model" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="her2bdl.models.mcdropout.EfficientNetMCDropout.build_encoder_model">
<em class="property"><span class="pre">static</span> </em><span class="sig-name descname"><span class="pre">build_encoder_model</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">input_shape</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#her2bdl.models.mcdropout.EfficientNetMCDropout.build_encoder_model" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="her2bdl.models.mcdropout.HEDConvClassifierMCDropout">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">her2bdl.models.mcdropout.</span></span><span class="sig-name descname"><span class="pre">HEDConvClassifierMCDropout</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#her2bdl.models.mcdropout.HEDConvClassifierMCDropout" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#her2bdl.models.mcdropout.MCDropoutModel" title="her2bdl.models.mcdropout.MCDropoutModel"><code class="xref py py-class docutils literal notranslate"><span class="pre">her2bdl.models.mcdropout.MCDropoutModel</span></code></a></p>
<p>HED Stain separator Classifier with MonteCarlo Dropout.</p>
<p>Convolutional neural network model that use the Separate_HED_stains layer.</p>
<p>This model takes input images of any shape, and the input data
should range [0, 255].</p>
<dl class="py attribute">
<dt class="sig sig-object py" id="her2bdl.models.mcdropout.HEDConvClassifierMCDropout.CONV_KERNEL_INITIALIZER">
<span class="sig-name descname"><span class="pre">CONV_KERNEL_INITIALIZER</span></span><em class="property"> <span class="pre">=</span> <span class="pre">{'class_name':</span> <span class="pre">'VarianceScaling',</span> <span class="pre">'config':</span> <span class="pre">{'distribution':</span> <span class="pre">'normal',</span> <span class="pre">'mode':</span> <span class="pre">'fan_out',</span> <span class="pre">'scale':</span> <span class="pre">2.0}}</span></em><a class="headerlink" href="#her2bdl.models.mcdropout.HEDConvClassifierMCDropout.CONV_KERNEL_INITIALIZER" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="her2bdl.models.mcdropout.HEDConvClassifierMCDropout.build_classifier_model">
<em class="property"><span class="pre">static</span> </em><span class="sig-name descname"><span class="pre">build_classifier_model</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">latent_variables_shape</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_classes</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mc_dropout_rate</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.2</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#her2bdl.models.mcdropout.HEDConvClassifierMCDropout.build_classifier_model" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="her2bdl.models.mcdropout.HEDConvClassifierMCDropout.build_encoder_model">
<em class="property"><span class="pre">static</span> </em><span class="sig-name descname"><span class="pre">build_encoder_model</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">input_shape</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#her2bdl.models.mcdropout.HEDConvClassifierMCDropout.build_encoder_model" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="her2bdl.models.mcdropout.MCDropoutModel">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">her2bdl.models.mcdropout.</span></span><span class="sig-name descname"><span class="pre">MCDropoutModel</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#her2bdl.models.mcdropout.MCDropoutModel" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">tensorflow.python.keras.engine.training.Model</span></code></p>
<p>MonteCarlo Dropout base model.</p>
<p>MCDropoutModel is a abstract model for building new classification models
and measure epistemic uncertainty using the method Monte-Carlo Dropout, defined
by the author in [1].</p>
<p>This implementation has methods from <cite>tf.keras.Model</cite> for training and predict,
but also includes a method for GPU efficient stochastics forward passes,
predictive distribution and uncertainty estimation.</p>
<p>Develop new MonteCarlo Dropout models by inheriting from this class. These
new models must implement <cite>build_encoder_model</cite> and <cite>build_classifier_model</cite>
and define their deterministic and stochastics corresponding to submodels
meta-architecture.</p>
<dl class="py method">
<dt class="sig sig-object py" id="her2bdl.models.mcdropout.MCDropoutModel.build_classifier_model">
<em class="property"><span class="pre">static</span> </em><span class="sig-name descname"><span class="pre">build_classifier_model</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">latent_variables_shape</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_classes</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mc_dropout_rate</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.5</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#her2bdl.models.mcdropout.MCDropoutModel.build_classifier_model" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="her2bdl.models.mcdropout.MCDropoutModel.build_encoder_model">
<em class="property"><span class="pre">static</span> </em><span class="sig-name descname"><span class="pre">build_encoder_model</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">input_shape</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#her2bdl.models.mcdropout.MCDropoutModel.build_encoder_model" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="her2bdl.models.mcdropout.MCDropoutModel.call">
<span class="sig-name descname"><span class="pre">call</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">inputs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#her2bdl.models.mcdropout.MCDropoutModel.call" title="Permalink to this definition">¶</a></dt>
<dd><p>Calls the model on new inputs.</p>
<p>In this case <cite>call</cite> just reapplies
all ops in the graph to the new inputs
(e.g. build a new computational graph from the provided inputs).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>inputs</strong> – A tensor or list of tensors.</p></li>
<li><p><strong>training</strong> – Boolean or boolean scalar tensor, indicating whether to run
the <cite>Network</cite> in training mode or inference mode.</p></li>
<li><p><strong>mask</strong> – A mask or list of masks. A mask can be
either a tensor or None (no mask).</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A tensor if there is a single output, or
a list of tensors if there are more than one outputs.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="her2bdl.models.mcdropout.MCDropoutModel.get_aleatoric_model">
<span class="sig-name descname"><span class="pre">get_aleatoric_model</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">aleatoric_weights</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#her2bdl.models.mcdropout.MCDropoutModel.get_aleatoric_model" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="her2bdl.models.mcdropout.MCDropoutModel.load_aleatoric_weights">
<span class="sig-name descname"><span class="pre">load_aleatoric_weights</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">load_aleatoric_weights</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#her2bdl.models.mcdropout.MCDropoutModel.load_aleatoric_weights" title="Permalink to this definition">¶</a></dt>
<dd><p>Load</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="her2bdl.models.mcdropout.MCDropoutModel.mutual_information">
<span class="sig-name descname"><span class="pre">mutual_information</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_predictive_distribution</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_predictions_samples</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sample_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#her2bdl.models.mcdropout.MCDropoutModel.mutual_information" title="Permalink to this definition">¶</a></dt>
<dd><blockquote>
<div><p>Measure of the mutual dependence between the two variables. More
specifically, it quantifies the “amount of information” (in units
such as shannons, commonly called bits) obtained about one random
variable through observing the other random variable.
.. math::
mathbb{        ilde{I}}[y, omega|x,  D_{      ext{train}}] :=          -sum_{k} (</p>
</div></blockquote>
<p>rac{1}{T}sum_t p(y=C_k| x, hat{omega}_t))           log(
rac{1}{T}sum_t p(y=C_k| x, hat{omega}_t))          +
rac{1}{T}sum_{k}sum_{t} p(y=C_k|x, hat{omega}_t)           log(p(y=C_k|x, hat{omega}_t))</p>
<blockquote>
<div><dl>
<dt>x<span class="classifier"><cite>np.ndarray</cite>  (batch_size, <a href="#id5"><span class="problematic" id="id6">*</span></a>input_shape) or <cite>None</cite></span></dt><dd><p>Batch of inputs. If is <cite>None</cite> use precalculated <cite>y_predictive_distribution</cite>.</p>
</dd>
<dt>y_predictive_distribution<span class="classifier"><cite>np.ndarray</cite> (batch_size, classes) or <cite>None</cite></span></dt><dd><p>Model’s predictive distributions (normalized histogram). Ignored
if <cite>x</cite> is not <cite>None</cite>.</p>
</dd>
<dt>y_predictions_samples<span class="classifier"><cite>np.ndarray</cite> (batch_size, sample size, classes)</span></dt><dd><p>Forward pass samples. Ignored if <cite>x</cite> is not <cite>None</cite>.</p>
</dd>
<dt>sample_size<span class="classifier"><cite>int</cite> or <cite>None</cite></span></dt><dd><p>Number of fordward passes, also refers as <cite>T</cite>. If it is <cite>None</cite>
use model`s sample size.</p>
</dd>
<dt>kwargs :</dt><dd><p>keras.Model.predict kwargs.</p>
</dd>
</dl>
<blockquote>
<div><dl class="simple">
<dt><a href="#id7"><span class="problematic" id="id8">``</span></a>np.ndarray` with shape (batch_size,).</dt><dd><p>Return mutual information for a batch.</p>
</dd>
</dl>
</div></blockquote>
</div></blockquote>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="her2bdl.models.mcdropout.MCDropoutModel.predict_distribution">
<span class="sig-name descname"><span class="pre">predict_distribution</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">return_y_pred</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">return_samples</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sample_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#her2bdl.models.mcdropout.MCDropoutModel.predict_distribution" title="Permalink to this definition">¶</a></dt>
<dd><p>Calculate predictive distrution by T stochastic forward passes.
See [1] 3.3.1 Uncertainty in classification
This method returns the following <cite>np.ndarray</cite>:
- <cite>y_predictive_distribution</cite> is a normalized histogram with shape:</p>
<blockquote>
<div><p>(batch_size, classes)</p>
</div></blockquote>
<ul class="simple">
<li><p><cite>y_pred</cite> is the class predicted with shape: (batch_size,)</p></li>
<li><p><cite>y_predictions_samples</cite> are samples from T forward passes samples,
with shape: (batch_size, sample size, classes)</p></li>
</ul>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>x</strong> (<cite>np.ndarray</cite>  (batch_size, <a href="#id9"><span class="problematic" id="id10">*</span></a>input_shape)) – Batch of inputs, if is one input, automatically it’s converted to
a batch.</p></li>
<li><p><strong>return_y_pred</strong> (<cite>bool</cite>) – Return argmax y_predictive_distribution. If is <cite>False</cite>
<cite>y_pred</cite> is <cite>None</cite>.</p></li>
<li><p><strong>return_samples</strong> (<cite>bool</cite>) – Return forward passes samples. Required by variation_ratio  and
mutual information.
If is <cite>False</cite> <cite>y_predictions_samples</cite> is <cite>None</cite>.</p></li>
<li><p><strong>sample_size</strong> (<cite>int</cite> or <cite>None</cite>) – Number of fordward passes, also refers as <cite>T</cite>. If it is <cite>None</cite>
use model`s sample size.</p></li>
<li><p><strong>kwargs</strong> – keras.Model.predict kwargs.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p><cite>tuple</cite> of <cite>np.ndarray</cite> with length batch_size. – Return 3 arrays with the model’s predictive distributions.</p></li>
<li><p>If <cite>return_samples</cite> is <cite>False</cite> return only predictive distribution.</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="her2bdl.models.mcdropout.MCDropoutModel.predict_with_epistemic_uncertainty">
<span class="sig-name descname"><span class="pre">predict_with_epistemic_uncertainty</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dataset</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">include_data</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#her2bdl.models.mcdropout.MCDropoutModel.predict_with_epistemic_uncertainty" title="Permalink to this definition">¶</a></dt>
<dd><p>Prediction and epistemic uncertainty results for x dataset.
:param dataset: Data generator or TF_Dataset.
:type dataset: <cite>keras.utils.Sequence</cite> or <cite>ParallelMapDataset</cite>
:param include_data: Returns x and y_true from dataset.
:type include_data: <cite>bool`</cite>
:param kwargs: keras.Model.predict kwargs.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>Prediction and uncertainty results for x dataset.</p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>(<cite>dict</cite>, <cite>dict</cite>)</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="her2bdl.models.mcdropout.MCDropoutModel.predictive_entropy">
<span class="sig-name descname"><span class="pre">predictive_entropy</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_predictive_distribution</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sample_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#her2bdl.models.mcdropout.MCDropoutModel.predictive_entropy" title="Permalink to this definition">¶</a></dt>
<dd><blockquote>
<div><p>Predictive Entropy is the average amount of information contained in
the predictive distribution. Predictive entropy is a biases estimator.
The bias of this estimator will decrease as $T$ (<cite>sample_size</cite>) increases.
.. math::
mathbb{        ilde{H}}[y|x, D_{       ext{train}}]  :=            - sum_{k} (</p>
</div></blockquote>
<p>rac{1}{T}sum_t p(y=C_k| x, hat{omega}_t))                 log(
rac{1}{T}sum_t p(y=C_k| x, hat{omega}_t))</p>
<blockquote>
<div><dl>
<dt>x<span class="classifier"><cite>np.ndarray</cite>  (batch_size, <a href="#id11"><span class="problematic" id="id12">*</span></a>input_shape) or <cite>None</cite></span></dt><dd><p>Batch of inputs. If is <cite>None</cite> use precalculated <cite>y_predictive_distribution</cite>.</p>
</dd>
<dt>y_predictive_distribution<span class="classifier"><cite>np.ndarray</cite> (batch_size, classes) or <cite>None</cite></span></dt><dd><p>Model’s predictive distributions (normalized histogram). Ignore
if <cite>x</cite> is not <cite>None</cite>.</p>
</dd>
<dt>sample_size<span class="classifier"><cite>int</cite> or <cite>None</cite></span></dt><dd><p>Number of fordward passes, also refers as <cite>T</cite>. If it is <cite>None</cite>
use model`s sample size.</p>
</dd>
<dt>kwargs :</dt><dd><p>keras.Model.predict kwargs.</p>
</dd>
</dl>
<blockquote>
<div><dl class="simple">
<dt><a href="#id13"><span class="problematic" id="id14">``</span></a>np.ndarray` with shape (batch_size,).</dt><dd><p>Return predictive entropy for a batch.</p>
</dd>
</dl>
</div></blockquote>
</div></blockquote>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="her2bdl.models.mcdropout.MCDropoutModel.uncertainty">
<span class="sig-name descname"><span class="pre">uncertainty</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_predictive_distribution</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_predictions_samples</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">get_predictive_entropy</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">get_multual_information</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">get_variation_ratio</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sample_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">return_dict</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#her2bdl.models.mcdropout.MCDropoutModel.uncertainty" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="her2bdl.models.mcdropout.MCDropoutModel.variation_ratio">
<span class="sig-name descname"><span class="pre">variation_ratio</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_predictions_samples</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_classes</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sample_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#her2bdl.models.mcdropout.MCDropoutModel.variation_ratio" title="Permalink to this definition">¶</a></dt>
<dd><blockquote>
<div><p>Collecting a set of $T$ labels $y_t$ from multiple stochastic forward
passes on the same input, we can find the mode of the distribution
$k^∗ = rgmax_{k}sum_t mathbb{1}[y_t = C_k]$, and the number of
times it was sampled $f_x = sum_tmathbb{1}[y_t = C_{k^*}]$.
.. math:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ext</span><span class="p">{</span><span class="n">variation</span><span class="o">-</span><span class="n">ratios</span><span class="p">}[</span><span class="n">x</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span><span class="o">-</span>
</pre></div>
</div>
</div></blockquote>
<dl>
<dt>rac{f_x}{T}</dt><dd><dl>
<dt>x<span class="classifier"><cite>np.ndarray</cite>  (batch_size, <a href="#id15"><span class="problematic" id="id16">*</span></a>input_shape) or <cite>None</cite></span></dt><dd><p>Batch of inputs. If is <cite>None</cite> use precalculated
<cite>y_predictive_distribution</cite>.</p>
</dd>
<dt>y_predictions_samples<span class="classifier"><cite>np.ndarray</cite> (batch_size, sample size, classes)</span></dt><dd><p>Forward pass samples. Ignored if <cite>x</cite> is not <cite>None</cite>.</p>
</dd>
<dt>num_classes<span class="classifier"><cite>int</cite> or <cite>None</cite></span></dt><dd><p>Number of classes.</p>
</dd>
<dt>sample_size<span class="classifier"><cite>int</cite> or <cite>None</cite></span></dt><dd><p>Number of fordward passes, also refers as <cite>T</cite>. If it is <cite>None</cite>
use model`s sample size.</p>
</dd>
<dt>kwargs :</dt><dd><p>keras.Model.predict kwargs.</p>
</dd>
</dl>
<blockquote>
<div><dl class="simple">
<dt><a href="#id17"><span class="problematic" id="id18">``</span></a>np.ndarray` with shape (batch_size,).</dt><dd><p>Return predictive entropy for a the batch.</p>
</dd>
</dl>
</div></blockquote>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="her2bdl.models.mcdropout.RGBConvClassifierMCDropout">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">her2bdl.models.mcdropout.</span></span><span class="sig-name descname"><span class="pre">RGBConvClassifierMCDropout</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#her2bdl.models.mcdropout.RGBConvClassifierMCDropout" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#her2bdl.models.mcdropout.HEDConvClassifierMCDropout" title="her2bdl.models.mcdropout.HEDConvClassifierMCDropout"><code class="xref py py-class docutils literal notranslate"><span class="pre">her2bdl.models.mcdropout.HEDConvClassifierMCDropout</span></code></a></p>
<p>RGB Classifier with MonteCarlo Dropout.</p>
<p>Convolutional neural network model with an architecture comparable to
the HEDConvClassifierMCDropout model.</p>
<p>This model takes input images of any shape, and the input data
should range [0, 255].</p>
<dl class="py method">
<dt class="sig sig-object py" id="her2bdl.models.mcdropout.RGBConvClassifierMCDropout.build_encoder_model">
<em class="property"><span class="pre">static</span> </em><span class="sig-name descname"><span class="pre">build_encoder_model</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">input_shape</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#her2bdl.models.mcdropout.RGBConvClassifierMCDropout.build_encoder_model" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="her2bdl.models.mcdropout.SimpleClassifierMCDropout">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">her2bdl.models.mcdropout.</span></span><span class="sig-name descname"><span class="pre">SimpleClassifierMCDropout</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#her2bdl.models.mcdropout.SimpleClassifierMCDropout" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#her2bdl.models.mcdropout.MCDropoutModel" title="her2bdl.models.mcdropout.MCDropoutModel"><code class="xref py py-class docutils literal notranslate"><span class="pre">her2bdl.models.mcdropout.MCDropoutModel</span></code></a></p>
<p>SimpleClassifier with MonteCarlo Dropout.</p>
<p>Convolutional neural network model for testing purposes.</p>
<dl class="py method">
<dt class="sig sig-object py" id="her2bdl.models.mcdropout.SimpleClassifierMCDropout.build_classifier_model">
<em class="property"><span class="pre">static</span> </em><span class="sig-name descname"><span class="pre">build_classifier_model</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">latent_variables_shape</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num_classes</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mc_dropout_rate</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.5</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#her2bdl.models.mcdropout.SimpleClassifierMCDropout.build_classifier_model" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="her2bdl.models.mcdropout.SimpleClassifierMCDropout.build_encoder_model">
<em class="property"><span class="pre">static</span> </em><span class="sig-name descname"><span class="pre">build_encoder_model</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">input_shape</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#her2bdl.models.mcdropout.SimpleClassifierMCDropout.build_encoder_model" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

</div>
</div>
<div class="section" id="module-her2bdl.models.metrics">
<span id="her2bdl-models-metrics-module"></span><h2>her2bdl.models.metrics module<a class="headerlink" href="#module-her2bdl.models.metrics" title="Permalink to this headline">¶</a></h2>
<div class="section" id="classification-metrics">
<h3>Classification Metrics<a class="headerlink" href="#classification-metrics" title="Permalink to this headline">¶</a></h3>
<p>Metrics for multiclass classification.</p>
<p>[1] HAGHIGHI, Sepand, et al. PyCM: Multiclass confusion matrix library in Python. Journal of Open Source Software, 2018, vol. 3, no 25, p. 729.</p>
<dl class="py function">
<dt class="sig sig-object py" id="her2bdl.models.metrics.class_stat">
<span class="sig-prename descclassname"><span class="pre">her2bdl.models.metrics.</span></span><span class="sig-name descname"><span class="pre">class_stat</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">y_true</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_pred</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">labels</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">metrics</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">['TP',</span> <span class="pre">'FP',</span> <span class="pre">'TN',</span> <span class="pre">'FN',</span> <span class="pre">'PPV',</span> <span class="pre">'TPR',</span> <span class="pre">'ACC',</span> <span class="pre">'F1']</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#her2bdl.models.metrics.class_stat" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="her2bdl.models.metrics.confusion_matrix">
<span class="sig-prename descclassname"><span class="pre">her2bdl.models.metrics.</span></span><span class="sig-name descname"><span class="pre">confusion_matrix</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">y_true</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_pred</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">labels</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#her2bdl.models.metrics.confusion_matrix" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="her2bdl.models.metrics.multiclass_roc_curve">
<span class="sig-prename descclassname"><span class="pre">her2bdl.models.metrics.</span></span><span class="sig-name descname"><span class="pre">multiclass_roc_curve</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">y_true</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_prob</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#her2bdl.models.metrics.multiclass_roc_curve" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="her2bdl.models.metrics.overall_stat">
<span class="sig-prename descclassname"><span class="pre">her2bdl.models.metrics.</span></span><span class="sig-name descname"><span class="pre">overall_stat</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">y_true</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_pred</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">labels</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">metrics</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">['PPV</span> <span class="pre">Micro',</span> <span class="pre">'TPR</span> <span class="pre">Micro',</span> <span class="pre">'PPV</span> <span class="pre">Macro',</span> <span class="pre">'TPR</span> <span class="pre">Macro',</span> <span class="pre">'ACC</span> <span class="pre">Macro',</span> <span class="pre">'ERR</span> <span class="pre">Macro']</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#her2bdl.models.metrics.overall_stat" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</div>
</div>
<div class="section" id="module-her2bdl.models.uncertainty">
<span id="her2bdl-models-uncertainty-module"></span><h2>her2bdl.models.uncertainty module<a class="headerlink" href="#module-her2bdl.models.uncertainty" title="Permalink to this headline">¶</a></h2>
<div class="section" id="uncertainty-meassures">
<h3>Uncertainty Meassures<a class="headerlink" href="#uncertainty-meassures" title="Permalink to this headline">¶</a></h3>
<p>Uncertainty measures for classification.</p>
<p>[1] GAL, Yarin. Uncertainty in deep learning. University of Cambridge, 2016, vol. 1, no 3.</p>
<dl class="py function">
<dt class="sig sig-object py" id="her2bdl.models.uncertainty.mutual_information">
<span class="sig-prename descclassname"><span class="pre">her2bdl.models.uncertainty.</span></span><span class="sig-name descname"><span class="pre">mutual_information</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">y_predictive_distribution</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_predictions_samples</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">is_sample</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">normalize</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">weights</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#her2bdl.models.uncertainty.mutual_information" title="Permalink to this definition">¶</a></dt>
<dd><blockquote>
<div><p>Measure of the mutual dependence between the two variables. More
specifically, it quantifies the “amount of information” (in units
such as shannons, commonly called bits) obtained about one random
variable through observing the other random variable.
.. math::
mathbb{    ilde{I}}[y, omega|x,  D_{      ext{train}}] :=        -sum_{k} (</p>
</div></blockquote>
<p>rac{1}{T}sum_t p(y=C_k| x, hat{omega}_t))        log(
rac{1}{T}sum_t p(y=C_k| x, hat{omega}_t))        +
rac{1}{T}sum_{k}sum_{t} p(y=C_k|x, hat{omega}_t)        log(p(y=C_k|x, hat{omega}_t))</p>
<blockquote>
<div><dl>
<dt>y_predictive_distribution<span class="classifier"><cite>np.ndarray</cite> (batch_size, classes)</span></dt><dd><p>Model’s predictive distributions (normalized histogram).</p>
</dd>
<dt>y_predictions_samples<span class="classifier"><cite>np.ndarray</cite> (batch_size, sample size, classes)</span></dt><dd><p>Forward pass samples.</p>
</dd>
<dt>is_sample:  <cite>bool</cite></dt><dd><p>Calculate entropy for a sample instead of a batch of samples</p>
</dd>
<dt>normalize:  <cite>bool</cite></dt><dd><p>Change range into [0,1]</p>
</dd>
<dt>weights: <cite>np.ndarray</cite> (batch_size,)</dt><dd><p>weight of samples.</p>
</dd>
</dl>
<blockquote>
<div><dl class="simple">
<dt><a href="#id19"><span class="problematic" id="id20">``</span></a>np.ndarray` with shape (batch_size,).</dt><dd><p>Return mutual information for a batch.</p>
</dd>
</dl>
</div></blockquote>
</div></blockquote>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="her2bdl.models.uncertainty.predictive_entropy">
<span class="sig-prename descclassname"><span class="pre">her2bdl.models.uncertainty.</span></span><span class="sig-name descname"><span class="pre">predictive_entropy</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">y_predictive_distribution</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">is_sample</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">normalize</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#her2bdl.models.uncertainty.predictive_entropy" title="Permalink to this definition">¶</a></dt>
<dd><blockquote>
<div><p>Predictive Entropy is the average amount of information contained in
the predictive distribution. Predictive entropy is a biases estimator.
The bias of this estimator will decrease as $T$ (<cite>sample_size</cite>) increases.
.. math::
mathbb{    ilde{H}}[y|x, D_{       ext{train}}]  :=        - sum_{k} (</p>
</div></blockquote>
<p>rac{1}{T}sum_t p(y=C_k| x, hat{omega}_t))             log(
rac{1}{T}sum_t p(y=C_k| x, hat{omega}_t))</p>
<blockquote>
<div><dl>
<dt>y_predictive_distribution<span class="classifier"><cite>np.ndarray</cite> (batch_size, classes)</span></dt><dd><p>Model’s predictive distributions (normalized histogram).</p>
</dd>
<dt>is_sample:  <cite>bool</cite></dt><dd><p>Calculate entropy for a sample instead of a batch of samples</p>
</dd>
<dt>normalize:  <cite>bool</cite></dt><dd><p>Change range into [0,1]</p>
</dd>
</dl>
<blockquote>
<div><dl class="simple">
<dt><a href="#id21"><span class="problematic" id="id22">``</span></a>np.ndarray` with shape (batch_size,).</dt><dd><p>Return predictive entropy for a batch.</p>
</dd>
</dl>
</div></blockquote>
</div></blockquote>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="her2bdl.models.uncertainty.variation_ratio">
<span class="sig-prename descclassname"><span class="pre">her2bdl.models.uncertainty.</span></span><span class="sig-name descname"><span class="pre">variation_ratio</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">y_predictions_samples</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">is_sample</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">weights</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#her2bdl.models.uncertainty.variation_ratio" title="Permalink to this definition">¶</a></dt>
<dd><blockquote>
<div><p>Collecting a set of $T$ labels $y_t$ from multiple stochastic forward
passes on the same input, we can find the mode of the distribution
$k^∗ = rgmax_{k}sum_t mathbb{1}[y_t = C_k]$, and the number of
times it was sampled $f_x = sum_tmathbb{1}[y_t = C_{k^*}]$.
.. math:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ext</span><span class="p">{</span><span class="n">variation</span><span class="o">-</span><span class="n">ratios</span><span class="p">}[</span><span class="n">x</span><span class="p">]</span><span class="o">=</span><span class="mi">1</span><span class="o">-</span>
</pre></div>
</div>
</div></blockquote>
<dl>
<dt>rac{f_x}{T}</dt><dd><dl>
<dt>y_predictions_samples<span class="classifier"><cite>np.ndarray</cite> (batch_size, classes)</span></dt><dd><p>Model’s predictive distributions (normalized histogram).</p>
</dd>
</dl>
<blockquote>
<div><dl class="simple">
<dt><a href="#id23"><span class="problematic" id="id24">``</span></a>np.ndarray` with shape (batch_size,).</dt><dd><p>Return predictive entropy for a the batch.</p>
</dd>
</dl>
</div></blockquote>
</dd>
</dl>
</dd></dl>

</div>
</div>
<div class="section" id="module-her2bdl.models">
<span id="module-contents"></span><h2>Module contents<a class="headerlink" href="#module-her2bdl.models" title="Permalink to this headline">¶</a></h2>
<div class="section" id="models">
<h3>Models<a class="headerlink" href="#models" title="Permalink to this headline">¶</a></h3>
<p>Custom models, meta-models, layers and loss funtions.</p>
<dl class="py data">
<dt class="sig sig-object py" id="her2bdl.models.CUSTOM_OBJECTS">
<span class="sig-prename descclassname"><span class="pre">her2bdl.models.</span></span><span class="sig-name descname"><span class="pre">CUSTOM_OBJECTS</span></span><em class="property"> <span class="pre">=</span> <span class="pre">{'CategoricalCrossentropy':</span> <span class="pre">&lt;class</span> <span class="pre">'tensorflow.python.keras.losses.CategoricalCrossentropy'&gt;,</span> <span class="pre">'Separate_HED_stains':</span> <span class="pre">&lt;class</span> <span class="pre">'her2bdl.models.layers.Separate_HED_stains'&gt;}</span></em><a class="headerlink" href="#her2bdl.models.CUSTOM_OBJECTS" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py data">
<dt class="sig sig-object py" id="her2bdl.models.LAYERS">
<span class="sig-prename descclassname"><span class="pre">her2bdl.models.</span></span><span class="sig-name descname"><span class="pre">LAYERS</span></span><em class="property"> <span class="pre">=</span> <span class="pre">{'Separate_HED_stains':</span> <span class="pre">&lt;class</span> <span class="pre">'her2bdl.models.layers.Separate_HED_stains'&gt;}</span></em><a class="headerlink" href="#her2bdl.models.LAYERS" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py data">
<dt class="sig sig-object py" id="her2bdl.models.LOSS">
<span class="sig-prename descclassname"><span class="pre">her2bdl.models.</span></span><span class="sig-name descname"><span class="pre">LOSS</span></span><em class="property"> <span class="pre">=</span> <span class="pre">{'CategoricalCrossentropy':</span> <span class="pre">&lt;class</span> <span class="pre">'tensorflow.python.keras.losses.CategoricalCrossentropy'&gt;}</span></em><a class="headerlink" href="#her2bdl.models.LOSS" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="py data">
<dt class="sig sig-object py" id="her2bdl.models.OPTIMIZERS">
<span class="sig-prename descclassname"><span class="pre">her2bdl.models.</span></span><span class="sig-name descname"><span class="pre">OPTIMIZERS</span></span><em class="property"> <span class="pre">=</span> <span class="pre">{'adadelta':</span> <span class="pre">&lt;class</span> <span class="pre">'tensorflow.python.keras.optimizer_v2.adadelta.Adadelta'&gt;,</span> <span class="pre">'adam':</span> <span class="pre">&lt;class</span> <span class="pre">'tensorflow.python.keras.optimizer_v2.adam.Adam'&gt;,</span> <span class="pre">'rmsprop':</span> <span class="pre">&lt;class</span> <span class="pre">'tensorflow.python.keras.optimizer_v2.rmsprop.RMSprop'&gt;,</span> <span class="pre">'sgd':</span> <span class="pre">&lt;class</span> <span class="pre">'tensorflow.python.keras.optimizer_v2.gradient_descent.SGD'&gt;}</span></em><a class="headerlink" href="#her2bdl.models.OPTIMIZERS" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</div>
</div>
</div>


           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 202 ...0, Sebastián Bórquez G,.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>